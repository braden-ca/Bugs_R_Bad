<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Welcome To TaskMaster</h1>

    <div class = "add-task">
      <h2>Add Task</h2>
        <label> <h3>Task name</h3> <input type ="text" class="taskName"/></label>
        <label> <h3>Description</h3> <input type ="text" class="description"/></label> <!--description is optional-->
        <label> <h3>Due Date</h3> <input type ="date" class="dueDate"/></label>
        <label> <h3>Priority</h3> <input type ="number" class="priority" min="1" max="3"/></label>
        
        <br><br>
        <button>Submit</button>
    </div>

    <div class = "show-tasks">
      <h2>Tasks Due Today</h2>
        <ul id="task-list"></ul>

      <h2 style="color: red;">Overdue Tasks</h2>
      <button style="color: red;">Task C</button>
      
      <h2>Upcoming Tasks</h2>
      <button>Task D</button>
      
    </div>


    <script>

      // send tasks to backend
      var taskName = document.querySelector(".taskName");
      var description = document.querySelector(".description");
      var dueDate = document.querySelector(".dueDate");
      var priority = document.querySelector(".priority");
      var button = document.querySelector("button");

      button.addEventListener("click", ()=> { // when button is clicked
        if (taskName.value && dueDate.value && priority.value) { // check values are enteres
          if (priority.value >= 1 && priority.value <= 3) { // check priority is in bounds
            // save data into an object 
            var obj={ 
              name: taskName.value,
              description: description.value || "", // Include description if it's not empty
              date: dueDate.value,
              priority: priority.value
            };
            // send data to backend (where to send data, data sent)
            fetch("http://localhost:3000/tasks", {
              method: "POST",
              headers: {
                "Content-type": "application/json"
              },  // data being sent in vars
              body: JSON.stringify(obj) // transform json data into string
            })
          }
          else {
            console.error("Priority must be between 1 and 3");
          }
        }
        else {
          console.error("Please fill in all fields.");
        }
      })

      // Get tasks from the backend

      function renderTasks(tasks) { // Function to render tasks in the frontend UI
        const taskList = document.querySelector("#task-list");
        // Clear existing tasks
        taskList.innerHTML = "";
        // Loop through each task and render it
        tasks.forEach(task => {
          const taskItem = document.createElement("li");
          taskItem.textContent = `Task: ${task.name}, Description: ${task.description}, Due Date: ${task.date}, Priority: ${task.priority}`;
          taskList.appendChild(taskItem);
        });
      }

      function fetchTasks() {
        fetch("http://localhost:3000/tasks")
          .then(response => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then(tasks => {
            // Call renderTasks function to render the retrieved tasks
            renderTasks(tasks);
          })
          .catch(error => {
            console.error("Error fetching tasks:", error);
          });
      }

      // Call fetchTasks function to fetch and render tasks when the page loads
      window.addEventListener("load", fetchTasks);    
    </script>
  </body>
</html>
